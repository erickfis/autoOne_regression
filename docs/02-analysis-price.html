<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>Exploratory data analysis - price</title>
    
      <link rel="stylesheet" href="_static/pygments.css">
      <link rel="stylesheet" href="_static/theme.css">
      <link rel="stylesheet" href="_static/sphinx_press_theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>

      
      <script src="_static/theme-vendors.js"></script>
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Linear regression - OLS Model" href="03-ols.html" />
  <link rel="prev" title="Exploratory data analysis - features - TO DO" href="02-analysis.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">AutoOne Regression</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#autoone-price-prediction">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="01-cleaning.html" class="reference internal ">Data cleaning</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="02-analysis.html" class="reference internal ">Exploratory data analysis - features - TO DO</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Exploratory data analysis - price</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#Analysis-of-sample-distribution" class="reference internal">Analysis of sample distribution</a></li>
                
                  <li class="toctree-l2"><a href="#Discussion-about-outliers" class="reference internal">Discussion about outliers</a></li>
                
                  <li class="toctree-l2"><a href="#Log-transformation-on-prices" class="reference internal">Log transformation on prices</a></li>
                
                  <li class="toctree-l2"><a href="#Balancing-the-data" class="reference internal">Balancing the data</a></li>
                
                  <li class="toctree-l2"><a href="#Conclusion" class="reference internal">Conclusion</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="03-ols.html" class="reference internal ">Linear regression - OLS Model</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="04-sklearn-linear.html" class="reference internal ">Linear regression - sklearn</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="05-machine.html" class="reference internal ">Modeling with machine learning</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="06-scripts.html" class="reference internal ">Python scripts</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="07-about.html" class="reference internal ">About me</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Exploratory data analysis - price</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="02-analysis.html"
       title="previous chapter">← Exploratory data analysis - features - TO DO</a>
  </li>
  <li class="next">
    <a href="03-ols.html"
       title="next chapter">Linear regression - OLS Model →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Exploratory-data-analysis---price">
<h1>Exploratory data analysis - price<a class="headerlink" href="#Exploratory-data-analysis---price" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will cover:</p>
<ul class="simple">
<li><p>Analysis of sample distribution</p></li>
<li><p>Reducing skew</p></li>
<li><p>Outliers</p></li>
<li><p>Balancing the data</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>%load_ext autoreload
%autoreload 2

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline

import aux_functions as aux
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># loading the data and testing our script
df_old = pd.read_csv(&#39;data/df_transformed.csv&#39;)
df = pd.read_csv(&#39;data/Auto1-DS-TestData.csv&#39;)
df = aux.clean_data(df)

for col_type in [&#39;object&#39;, &#39;int64&#39;, &#39;float64&#39;]:
    test = (df.select_dtypes(col_type).describe() != df_old.select_dtypes(col_type).describe())
    if test.any().sum():
        print(&#39;not equal on &#39;, col_type)
    else:
        print(&#39;all ok with&#39;, col_type)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
all ok with object
all ok with int64
all ok with float64
</pre></div></div>
</div>
<div class="section" id="Analysis-of-sample-distribution">
<h2>Analysis of sample distribution<a class="headerlink" href="#Analysis-of-sample-distribution" title="Permalink to this headline">¶</a></h2>
<p>The goal here is to understand what distribution the variable prices follow.</p>
<p>Also, understanding the behavior of the data is essential for building good prediction models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.price.describe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
count      193.000000
mean     13285.025907
std       8089.082886
min       5118.000000
25%       7738.000000
50%      10245.000000
75%      16515.000000
max      45400.000000
Name: price, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>figsize = (14, 5)
df.price.plot(kind=&#39;kde&#39;, legend=True, figsize=figsize, title=&#39;Price distribution&#39;)
plt.vlines(8500, 0, .0001, label=&#39;peak A&#39;)
plt.vlines(34000, 0, .0001, label=&#39;peak B&#39;)
plt.vlines(df.price.mean(), 0, .0001, color=&#39;r&#39;, label=&#39;mean&#39;)
plt.vlines(df.price.median(), 0, .0001, color=&#39;g&#39;, label=&#39;median&#39;)
plt.legend()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19f387d5108&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_6_1.png" src="_images/02-analysis-price_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.price.plot(kind=&#39;hist&#39;, figsize=figsize, bins=20, title=&#39;Price Histogram&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x19f389dd848&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_7_1.png" src="_images/02-analysis-price_7_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>mask = df.price &gt; 35000
df.price[mask].plot(kind=&#39;hist&#39;, figsize=figsize, bins=20, title=&#39;Price Histogram - slice&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x19f388e3248&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_8_1.png" src="_images/02-analysis-price_8_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>mask = df.price &gt; 40000
df.price[mask]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16    41315.0
73    40960.0
74    45400.0
Name: price, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>fig, (ax, ax2, ax3) = plt.subplots(ncols=3, sharey=False)

figsize = (14, 5)
df.price.plot(kind=&#39;kde&#39;, legend=False, ax=ax,  figsize=figsize)
ax.vlines(8500, 0, .0001, label=&#39;peak A&#39;)
df.price.plot(kind=&#39;hist&#39;,ax=ax2, figsize=figsize)
df.price.plot(kind=&#39;box&#39;, legend=False, ax=ax3, figsize=figsize)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_10_0.png" src="_images/02-analysis-price_10_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># checking outliers through number of observations
df[&#39;price_cats&#39;] = pd.cut(df.price, bins=20)
df[&#39;price_cats&#39;].value_counts().sort_values()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(37343.6, 39357.7]     0
(41371.8, 43385.9]     0
(43385.9, 45400.0]     1
(29287.2, 31301.3]     1
(25259.0, 27273.1]     1
(39357.7, 41371.8]     2
(27273.1, 29287.2]     2
(23244.9, 25259.0]     2
(31301.3, 33315.4]     3
(33315.4, 35329.5]     3
(19216.7, 21230.8]     3
(35329.5, 37343.6]     4
(21230.8, 23244.9]     4
(13174.4, 15188.5]    13
(17202.6, 19216.7]    14
(11160.3, 13174.4]    17
(15188.5, 17202.6]    20
(9146.2, 11160.3]     23
(5077.718, 7132.1]    36
(7132.1, 9146.2]      44
Name: price_cats, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>top_wisker = df.price.quantile(.75) + 1.5*(df.price.quantile(.75) - df.price.quantile(.25))
print(f&#39;Wisker upper: {top_wisker}&#39;)

# prob for y &gt; top_wisker
import scipy.stats as st
prob = 1 - st.norm.cdf(top_wisker, df.price.mean(), df.price.std())
print(f&#39;prob for y &gt; top_wisker: {prob:.3}&#39;)

#99% quantile
qt = st.norm.ppf(.99, df.price.mean(), df.price.std()) # just exploring
print(f&#39;99% quantile: {qt:4.3}&#39;)

# prob for prices bellow 32k
prob = st.norm.cdf(32000, df.price.mean(), df.price.std()) # just exploring
print(f&#39;prob for prices bellow 32k: {prob:.3}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Wisker upper: 29680.5
prob for y &gt; top_wisker: 0.0213
99% quantile: 3.21e+04
prob for prices bellow 32k: 0.99
</pre></div></div>
</div>
<p>Important characteristics of the prices distribution:</p>
<ul class="simple">
<li><p>mean: \$13285.02</p></li>
<li><p>median: \$10245.00</p></li>
<li><p>standard deviation: \$8089.08</p></li>
<li><p>range: \$40282.00</p></li>
</ul>
<p>The prices distribution is bimodal with peaks around \$8500.00 and \$34000.00. However, in this study we will consider that this happens due to data skew.</p>
<p>The prices go from \$5118.00 to \$45400.00.</p>
</div>
<div class="section" id="Discussion-about-outliers">
<h2>Discussion about outliers<a class="headerlink" href="#Discussion-about-outliers" title="Permalink to this headline">¶</a></h2>
<p>Prices above \$38000.00 have only 03 observations. While it is very tempting to call them outliers, this is not really the case. We have sales at</p>
<ul class="simple">
<li><p>\$41315.00</p></li>
<li><p>\$40960.00</p></li>
<li><p>\$45400.00</p></li>
</ul>
<p>As those prices are in the same level as the prices of the regular sales, it becomes clear that they are not recorded by mistake. Those observations are just really rare on this sample.</p>
<p>If there was outliers among the observations we would remove them because outliers could be highly influential points and could leverage predictive models.</p>
</div>
<div class="section" id="Log-transformation-on-prices">
<h2>Log transformation on prices<a class="headerlink" href="#Log-transformation-on-prices" title="Permalink to this headline">¶</a></h2>
<p>As we saw in data analysis, the price variable has a really wide range and its highly skewed. Linear regression predictive algorithms will have some trouble, sometimes even predicting negative prices.</p>
<p>To better understand the patterns of the data and the correlation between the variable price and the independent variables, we will apply a log transformation on prices.</p>
<p>This transformation reshapes the distribution reducing its skewness.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from scipy import stats
import matplotlib.pyplot as plt
%matplotlib inline

fig, (ax, ax1) = plt.subplots(ncols=2, sharey=False, figsize=figsize)

prob = stats.probplot(df.price, dist=stats.norm, plot=ax)
ax.set_xlabel(&#39;&#39;)
ax.set_title(&#39;Original&#39;)

df[&#39;log_price&#39;] = np.log(df.price)
prob = stats.probplot(df[&#39;log_price&#39;], dist=stats.norm, plot=ax1)
ax1.set_title(&#39;log transformation&#39;)

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_15_0.png" src="_images/02-analysis-price_15_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>fig, (ax, ax1) = plt.subplots(ncols=2, sharey=False)
df.price.plot(kind=&#39;hist&#39;, legend=True, ax=ax, figsize=figsize)
df.log_price.plot(kind=&#39;hist&#39;, legend=True, ax=ax1, figsize=figsize)

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_16_0.png" src="_images/02-analysis-price_16_0.png" />
</div>
</div>
</div>
<div class="section" id="Balancing-the-data">
<h2>Balancing the data<a class="headerlink" href="#Balancing-the-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Splitting-cars-in-classes-according-to-its-price">
<h3>Splitting cars in classes according to its price<a class="headerlink" href="#Splitting-cars-in-classes-according-to-its-price" title="Permalink to this headline">¶</a></h3>
<p>Just to take a look into the distribution of prices and into the samples available for each price range, lets define car classes according to price ranges:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>labels = [
    &#39;almost-free&#39;, &#39;super-cheap&#39;, &#39;cheap&#39;,
    &#39;normal&#39;, &#39;expensive&#39;, &#39;super-expensive&#39;
]
df[&quot;class_range&quot;] = pd.cut(df.price, 6, labels=labels)
df.groupby(&#39;class_range&#39;)[[&#39;price&#39;]].min() # starting prices for each class
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
    </tr>
    <tr>
      <th>class_range</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>almost-free</th>
      <td>5118.0</td>
    </tr>
    <tr>
      <th>super-cheap</th>
      <td>11850.0</td>
    </tr>
    <tr>
      <th>cheap</th>
      <td>18620.0</td>
    </tr>
    <tr>
      <th>normal</th>
      <td>25552.0</td>
    </tr>
    <tr>
      <th>expensive</th>
      <td>32250.0</td>
    </tr>
    <tr>
      <th>super-expensive</th>
      <td>40960.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.class_range.value_counts()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
almost-free        110
super-cheap         53
cheap               13
expensive            9
normal               5
super-expensive      3
Name: class_range, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.class_range.value_counts(normalize=True).plot.bar(figsize=figsize)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x19f394c7b88&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_20_1.png" src="_images/02-analysis-price_20_1.png" />
</div>
</div>
</div>
<div class="section" id="Balancing-the-data:-bootstrap">
<h3>Balancing the data: bootstrap<a class="headerlink" href="#Balancing-the-data:-bootstrap" title="Permalink to this headline">¶</a></h3>
<p>Our dataset has only 197 observations and some price ranges are not well represented here. We will fix this balance issue through bootstrap: lets get more samples for each price range through bootstrap:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df_old = df.copy()
df = df.sample(10000, replace=True)
df.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10000, 28)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>fig, (ax, ax2) = plt.subplots(ncols=2, sharey=False, figsize=figsize)

df_old.price.plot(kind=&#39;kde&#39;, legend=False, ax=ax, title=&quot;original&quot;)
df.price.plot(kind=&#39;kde&#39;,ax=ax2, title=&quot;bootstrap&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_23_0.png" src="_images/02-analysis-price_23_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>fig, (ax, ax2) = plt.subplots(ncols=2, sharey=False, figsize=figsize)
df_old.class_range.value_counts(normalize=True).plot.bar(ax=ax, title=&#39;original&#39;)
df.class_range.value_counts(normalize=True).plot.bar(ax=ax2, title=&#39;bootstrap&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x19f39795a88&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/02-analysis-price_24_1.png" src="_images/02-analysis-price_24_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(
    &#39;original\n&#39;,
    df.class_range.value_counts(normalize=True),
    &#39;\n#########\n&#39;,
    &#39;bootstrap\n&#39;,
    df_old.class_range.value_counts(normalize=True)
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
original
 almost-free        0.5617
super-cheap        0.2856
cheap              0.0666
expensive          0.0469
normal             0.0267
super-expensive    0.0125
Name: class_range, dtype: float64
#########
 bootstrap
 almost-free        0.569948
super-cheap        0.274611
cheap              0.067358
expensive          0.046632
normal             0.025907
super-expensive    0.015544
Name: class_range, dtype: float64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this headline">¶</a></h2>
<p>From this brief analysis about prices, we found out:</p>
<ul class="simple">
<li><p>the distribution is not normal - could be bimodal as well</p></li>
<li><p>there are outliers and we have removed them</p></li>
<li><p>a log transformation on prices would be useful for linear models, since it reduces the skewness in prices distribution</p></li>
<li><p>there is no balance on price ranges: we addressed that through bootstrap.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.drop([&#39;log_price&#39;, &#39;class_range&#39;, &#39;price_cats&#39;], axis=1).to_csv(&#39;data/df_resample.csv&#39;, index=False)
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="02-analysis.html"
       title="previous chapter">← Exploratory data analysis - features - TO DO</a>
  </li>
  <li class="next">
    <a href="03-ols.html"
       title="next chapter">Linear regression - OLS Model →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, Erick Medeiros Anastácio.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>