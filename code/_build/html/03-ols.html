<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>Linear regression - OLS Model</title>
    
      <link rel="stylesheet" href="_static/pygments.css">
      <link rel="stylesheet" href="_static/theme.css">
      <link rel="stylesheet" href="_static/sphinx_press_theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>

      
      <script src="_static/theme-vendors.js"></script>
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Linear regression - sklearn" href="04-sklearn-linear.html" />
  <link rel="prev" title="Exploratory data analysis - price" href="02-analysis-price.html" /> 
  </head>

  <body>
    <div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <span class="site-name">AutoOne Regression</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#autoone-price-prediction">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="01-cleaning.html" class="reference internal ">Data cleaning</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="02-analysis.html" class="reference internal ">Exploratory data analysis - features - TO DO</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="02-analysis-price.html" class="reference internal ">Exploratory data analysis - price</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">Linear regression - OLS Model</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#Train-test-split" class="reference internal">Train-test split</a></li>
                
                  <li class="toctree-l2"><a href="#Feature-Selection" class="reference internal">Feature Selection</a></li>
                
                  <li class="toctree-l2"><a href="#Fitting-the-model" class="reference internal">Fitting the model</a></li>
                
                  <li class="toctree-l2"><a href="#More-feature-selection:-p-values" class="reference internal">More feature selection: p-values</a></li>
                
                  <li class="toctree-l2"><a href="#Model-Scoring-&-Evaluation" class="reference internal">Model Scoring & Evaluation</a></li>
                
                  <li class="toctree-l2"><a href="#Residual-analysis" class="reference internal">Residual analysis</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 "><a href="04-sklearn-linear.html" class="reference internal ">Linear regression - sklearn</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="05-machine.html" class="reference internal ">Modeling with machine learning</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="06-scripts.html" class="reference internal ">Python scripts</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="07-about.html" class="reference internal ">About me</a>

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Linear regression - OLS Model</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="02-analysis-price.html"
       title="previous chapter">← Exploratory data analysis - price</a>
  </li>
  <li class="next">
    <a href="04-sklearn-linear.html"
       title="next chapter">Linear regression - sklearn →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Linear-regression---OLS-Model">
<h1>Linear regression - OLS Model<a class="headerlink" href="#Linear-regression---OLS-Model" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will cover:</p>
<ul class="simple">
<li><p>fitting an OLS linear regression model</p></li>
<li><p>score analysis: MSE and variance explained: <span class="math notranslate nohighlight">\(R^2\)</span></p></li>
<li><p>residual analysis</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import pandas as pd
import numpy as np
import pickle
import time
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df = pd.read_csv(&#39;data/df_resample.csv&#39;)
df.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>symboling</th>
      <th>make</th>
      <th>fuel_type</th>
      <th>aspiration</th>
      <th>num_of_doors</th>
      <th>body_style</th>
      <th>drive_wheels</th>
      <th>engine_location</th>
      <th>wheel_base</th>
      <th>length</th>
      <th>...</th>
      <th>engine_size</th>
      <th>fuel_system</th>
      <th>bore</th>
      <th>stroke</th>
      <th>compression_ratio</th>
      <th>horsepower</th>
      <th>peak_rpm</th>
      <th>city_mpg</th>
      <th>highway_mpg</th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>nissan</td>
      <td>gas</td>
      <td>std</td>
      <td>four</td>
      <td>sedan</td>
      <td>fwd</td>
      <td>front</td>
      <td>97.2</td>
      <td>173.4</td>
      <td>...</td>
      <td>120</td>
      <td>2bbl</td>
      <td>3.33</td>
      <td>3.47</td>
      <td>8.5</td>
      <td>97.0</td>
      <td>5200.0</td>
      <td>27</td>
      <td>34</td>
      <td>9549.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>volkswagen</td>
      <td>gas</td>
      <td>std</td>
      <td>two</td>
      <td>hatchback</td>
      <td>fwd</td>
      <td>front</td>
      <td>94.5</td>
      <td>165.7</td>
      <td>...</td>
      <td>109</td>
      <td>mpfi</td>
      <td>3.19</td>
      <td>3.40</td>
      <td>8.5</td>
      <td>90.0</td>
      <td>5500.0</td>
      <td>24</td>
      <td>29</td>
      <td>9980.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>bmw</td>
      <td>gas</td>
      <td>std</td>
      <td>four</td>
      <td>sedan</td>
      <td>rwd</td>
      <td>front</td>
      <td>103.5</td>
      <td>189.0</td>
      <td>...</td>
      <td>164</td>
      <td>mpfi</td>
      <td>3.31</td>
      <td>3.19</td>
      <td>9.0</td>
      <td>121.0</td>
      <td>4250.0</td>
      <td>20</td>
      <td>25</td>
      <td>24565.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>subaru</td>
      <td>gas</td>
      <td>std</td>
      <td>two</td>
      <td>hatchback</td>
      <td>fwd</td>
      <td>front</td>
      <td>93.7</td>
      <td>156.9</td>
      <td>...</td>
      <td>97</td>
      <td>2bbl</td>
      <td>3.62</td>
      <td>2.36</td>
      <td>9.0</td>
      <td>69.0</td>
      <td>4900.0</td>
      <td>31</td>
      <td>36</td>
      <td>5118.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>mazda</td>
      <td>diesel</td>
      <td>std</td>
      <td>four</td>
      <td>sedan</td>
      <td>rwd</td>
      <td>front</td>
      <td>104.9</td>
      <td>175.0</td>
      <td>...</td>
      <td>134</td>
      <td>idi</td>
      <td>3.43</td>
      <td>3.64</td>
      <td>22.0</td>
      <td>72.0</td>
      <td>4200.0</td>
      <td>31</td>
      <td>39</td>
      <td>18344.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>df.info()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10000 entries, 0 to 9999
Data columns (total 25 columns):
 #   Column             Non-Null Count  Dtype
---  ------             --------------  -----
 0   symboling          10000 non-null  int64
 1   make               10000 non-null  object
 2   fuel_type          10000 non-null  object
 3   aspiration         10000 non-null  object
 4   num_of_doors       10000 non-null  object
 5   body_style         10000 non-null  object
 6   drive_wheels       10000 non-null  object
 7   engine_location    10000 non-null  object
 8   wheel_base         10000 non-null  float64
 9   length             10000 non-null  float64
 10  width              10000 non-null  float64
 11  height             10000 non-null  float64
 12  curb_weight        10000 non-null  int64
 13  engine_type        10000 non-null  object
 14  num_of_cylinders   10000 non-null  object
 15  engine_size        10000 non-null  int64
 16  fuel_system        10000 non-null  object
 17  bore               10000 non-null  float64
 18  stroke             10000 non-null  float64
 19  compression_ratio  10000 non-null  float64
 20  horsepower         10000 non-null  float64
 21  peak_rpm           10000 non-null  float64
 22  city_mpg           10000 non-null  int64
 23  highway_mpg        10000 non-null  int64
 24  price              10000 non-null  float64
dtypes: float64(10), int64(5), object(10)
memory usage: 1.9+ MB
</pre></div></div>
</div>
<div class="section" id="Train-test-split">
<h2>Train-test split<a class="headerlink" href="#Train-test-split" title="Permalink to this headline">¶</a></h2>
<p>To avoid overfitting, we will split our data on train and test sets.</p>
<p>The model will be trained with the train dataset and later we will evaluate it with the test set.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from sklearn.model_selection import train_test_split

X = df.copy()
X.drop(&#39;price&#39;, axis=1, inplace=True)
y = np.log(df.price) # as discussed, we are going to use the log transformation here

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=.3, random_state=95276
)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Feature-Selection">
<h2>Feature Selection<a class="headerlink" href="#Feature-Selection" title="Permalink to this headline">¶</a></h2>
<p>It is very important to carefully chose which features will be included into the model, because:</p>
<ul class="simple">
<li><p>including unnecessary features increases the standard error of the coefficients</p></li>
<li><p>excluding necessary features results in bias</p></li>
</ul>
<div class="section" id="Selection-through-correlation">
<h3>Selection through correlation<a class="headerlink" href="#Selection-through-correlation" title="Permalink to this headline">¶</a></h3>
<p>As we want start trying out linear regression models, we will select features that have linear correlation with the dependent variable price.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># categorical features
with open(&#39;data/category_list&#39;, &#39;rb&#39;) as file:
    cat_cols = pickle.load(file)

# numeric columns
num_cols = [col for col in X_train.columns if col not in cat_cols]
num_cols
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;wheel_base&#39;,
 &#39;length&#39;,
 &#39;width&#39;,
 &#39;height&#39;,
 &#39;curb_weight&#39;,
 &#39;engine_size&#39;,
 &#39;bore&#39;,
 &#39;stroke&#39;,
 &#39;compression_ratio&#39;,
 &#39;horsepower&#39;,
 &#39;peak_rpm&#39;,
 &#39;city_mpg&#39;,
 &#39;highway_mpg&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>X_train[&#39;price&#39;] = y_train
cols = num_cols + [&#39;price&#39;]
cor = X_train[cols].corr().abs()
cor.loc[cor.price &gt; .5, &#39;price&#39;].sort_values()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\BJ571WQ\Anaconda3\lib\site-packages\ipykernel_launcher.py:1: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  &#34;&#34;&#34;Entry point for launching an IPython kernel.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
bore           0.590618
wheel_base     0.637270
length         0.780432
city_mpg       0.785230
highway_mpg    0.788294
width          0.803110
horsepower     0.827188
engine_size    0.844736
curb_weight    0.895085
price          1.000000
Name: price, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>mask = (cor.price &gt; .5 ) &amp; (cor.price &lt; 1)
correlated = cor[mask].sort_values(by=&#39;price&#39;).index
not_correlated = [col for col in num_cols if col not in correlated]

print(&#39;correlated: &#39;, correlated)
print(&#39;not correlated: &#39;, not_correlated)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
correlated:  Index([&#39;bore&#39;, &#39;wheel_base&#39;, &#39;length&#39;, &#39;city_mpg&#39;, &#39;highway_mpg&#39;, &#39;width&#39;,
       &#39;horsepower&#39;, &#39;engine_size&#39;, &#39;curb_weight&#39;],
      dtype=&#39;object&#39;)
not correlated:  [&#39;height&#39;, &#39;stroke&#39;, &#39;compression_ratio&#39;, &#39;peak_rpm&#39;]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Fitting-the-model">
<h2>Fitting the model<a class="headerlink" href="#Fitting-the-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Formula-for-OLS">
<h3>Formula for OLS<a class="headerlink" href="#Formula-for-OLS" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>cat_list = [f&#39;C({cat})&#39; for cat in cat_cols]
cat_formula = &#39; + &#39;.join(cat_list)
num_formula = &#39; + &#39;.join(correlated)

formula = f&#39;price ~ {cat_formula} + {num_formula}&#39;
formula
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;price ~ C(make) + C(fuel_type) + C(aspiration) + C(num_of_doors) + C(body_style) + C(drive_wheels) + C(engine_location) + C(engine_type) + C(num_of_cylinders) + C(fuel_system) + C(symboling) + bore + wheel_base + length + city_mpg + highway_mpg + width + horsepower + engine_size + curb_weight&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import statsmodels.formula.api as smf

start = time.time()
model = smf.ols(formula=formula, data=X_train)
stop = time.time()

elapsed = stop - start
res = model.fit()
print(res.summary())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                            OLS Regression Results
==============================================================================
Dep. Variable:                  price   R-squared:                       0.969
Model:                            OLS   Adj. R-squared:                  0.969
Method:                 Least Squares   F-statistic:                     3976.
Date:                Mon, 06 Jul 2020   Prob (F-statistic):               0.00
Time:                        08:48:38   Log-Likelihood:                 7096.2
No. Observations:                7000   AIC:                        -1.408e+04
Df Residuals:                    6944   BIC:                        -1.370e+04
Df Model:                          55
Covariance Type:            nonrobust
=================================================================================================
                                    coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
Intercept                         4.7194      0.071     66.565      0.000       4.580       4.858
C(make)[T.audi]                   0.3223      0.019     16.807      0.000       0.285       0.360
C(make)[T.bmw]                    0.3656      0.018     20.808      0.000       0.331       0.400
C(make)[T.chevrolet]             -0.0854      0.018     -4.718      0.000      -0.121      -0.050
C(make)[T.dodge]                 -0.1320      0.014     -9.546      0.000      -0.159      -0.105
C(make)[T.honda]                  0.1660      0.017      9.787      0.000       0.133       0.199
C(make)[T.isuzu]                 -0.4436      0.020    -22.238      0.000      -0.483      -0.405
C(make)[T.jaguar]                -0.1599      0.021     -7.591      0.000      -0.201      -0.119
C(make)[T.mazda]                 -0.0011      0.014     -0.084      0.933      -0.028       0.025
C(make)[T.mercedes-benz]         -0.0189      0.020     -0.942      0.346      -0.058       0.020
C(make)[T.mercury]               -0.0778      0.023     -3.320      0.001      -0.124      -0.032
C(make)[T.mitsubishi]            -0.1376      0.014     -9.711      0.000      -0.165      -0.110
C(make)[T.nissan]                 0.0138      0.013      1.062      0.288      -0.012       0.039
C(make)[T.peugot]                -0.2821      0.016    -18.150      0.000      -0.313      -0.252
C(make)[T.plymouth]              -0.1657      0.014    -12.015      0.000      -0.193      -0.139
C(make)[T.porsche]                0.3364      0.022     14.997      0.000       0.292       0.380
C(make)[T.saab]                   0.1741      0.016     10.705      0.000       0.142       0.206
C(make)[T.subaru]                -0.1974      0.013    -14.770      0.000      -0.224      -0.171
C(make)[T.toyota]                -0.1405      0.013    -11.237      0.000      -0.165      -0.116
C(make)[T.volkswagen]            -0.0154      0.014     -1.066      0.286      -0.044       0.013
C(make)[T.volvo]                 -0.0357      0.016     -2.168      0.030      -0.068      -0.003
C(fuel_type)[T.gas]               2.2407      0.035     63.510      0.000       2.172       2.310
C(aspiration)[T.turbo]            0.1349      0.006     21.058      0.000       0.122       0.147
C(num_of_doors)[T.two]           -0.0474      0.004    -10.734      0.000      -0.056      -0.039
C(body_style)[T.hardtop]         -0.1464      0.010    -14.358      0.000      -0.166      -0.126
C(body_style)[T.hatchback]       -0.1858      0.009    -20.640      0.000      -0.203      -0.168
C(body_style)[T.sedan]           -0.1872      0.010    -19.010      0.000      -0.207      -0.168
C(body_style)[T.wagon]           -0.2630      0.010    -25.327      0.000      -0.283      -0.243
C(drive_wheels)[T.rwd]            0.1927      0.007     29.121      0.000       0.180       0.206
C(engine_location)[T.rear]        0.2984      0.016     18.586      0.000       0.267       0.330
C(engine_type)[T.l]              -0.1144      0.014     -8.401      0.000      -0.141      -0.088
C(engine_type)[T.ohc]            -0.0648      0.009     -7.108      0.000      -0.083      -0.047
C(engine_type)[T.ohcf]            0.1011      0.008     12.244      0.000       0.085       0.117
C(engine_type)[T.ohcv]           -0.1056      0.011    -10.014      0.000      -0.126      -0.085
C(num_of_cylinders)[T.five]      -0.1452      0.024     -6.137      0.000      -0.192      -0.099
C(num_of_cylinders)[T.four]      -0.0754      0.029     -2.586      0.010      -0.133      -0.018
C(num_of_cylinders)[T.six]       -0.1888      0.022     -8.633      0.000      -0.232      -0.146
C(num_of_cylinders)[T.three]      0.1677      0.024      6.972      0.000       0.121       0.215
C(num_of_cylinders)[T.twelve]    -0.0545      0.030     -1.803      0.071      -0.114       0.005
C(fuel_system)[T.2bbl]            0.2087      0.012     17.444      0.000       0.185       0.232
C(fuel_system)[T.idi]             2.4787      0.037     67.266      0.000       2.406       2.551
C(fuel_system)[T.mfi]             0.2890      0.022     13.203      0.000       0.246       0.332
C(fuel_system)[T.mpfi]            0.2880      0.012     23.062      0.000       0.263       0.312
C(fuel_system)[T.spdi]            0.2471      0.015     16.480      0.000       0.218       0.276
C(fuel_system)[T.spfi]            0.5898      0.025     23.329      0.000       0.540       0.639
C(symboling)[T.-1]                0.1008      0.011      9.326      0.000       0.080       0.122
C(symboling)[T.0]                 0.1112      0.012      9.220      0.000       0.088       0.135
C(symboling)[T.1]                 0.0327      0.013      2.581      0.010       0.008       0.058
C(symboling)[T.2]              2.929e-05      0.013      0.002      0.998      -0.026       0.026
C(symboling)[T.3]                 0.0828      0.014      5.826      0.000       0.055       0.111
bore                             -0.1834      0.015    -12.535      0.000      -0.212      -0.155
wheel_base                        0.0084      0.001     11.295      0.000       0.007       0.010
length                           -0.0045      0.000    -10.618      0.000      -0.005      -0.004
city_mpg                         -0.0178      0.001    -15.892      0.000      -0.020      -0.016
highway_mpg                       0.0131      0.001     13.579      0.000       0.011       0.015
width                             0.0231      0.002     11.809      0.000       0.019       0.027
horsepower                       -0.0002      0.000     -0.887      0.375      -0.001       0.000
engine_size                       0.0022      0.000     10.676      0.000       0.002       0.003
curb_weight                       0.0005   1.25e-05     37.256      0.000       0.000       0.000
==============================================================================
Omnibus:                        5.085   Durbin-Watson:                   1.999
Prob(Omnibus):                  0.079   Jarque-Bera (JB):                5.197
Skew:                          -0.044   Prob(JB):                       0.0744
Kurtosis:                       3.100   Cond. No.                     1.02e+16
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 4.65e-22. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="More-feature-selection:-p-values">
<h2>More feature selection: p-values<a class="headerlink" href="#More-feature-selection:-p-values" title="Permalink to this headline">¶</a></h2>
<p>When we fit a linear regression model, we have to test the hypothesis that the evaluated coefficients for each regressor is actually zero, meaning we don’t need the regressor at all.</p>
<p>In other words, we have:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: the coefficient is zero</p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: the coefficient is not zero</p></li>
</ul>
<p>Therefore, let’s look into the p-values for each coefficient for each regressor to understand if they should be zero:</p>
<p><em>if a p-value of a given coefficient is larger than 5%, then we fail to reject the null hypothesis that the coefficient actually is zero</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>res.pvalues[res.pvalues &gt; .05]
# we are not taking out make just because a few rotten apples
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C(make)[T.mazda]                 0.932911
C(make)[T.mercedes-benz]         0.346465
C(make)[T.nissan]                0.288217
C(make)[T.volkswagen]            0.286270
C(num_of_cylinders)[T.twelve]    0.071427
C(symboling)[T.2]                0.998247
horsepower                       0.375116
dtype: float64
</pre></div></div>
</div>
<p>As we can see, the p-values for some makers are larger than 5%. We are not removing this feature.</p>
<p>Also, hypothesis testing for variable horsepower coefficient shows it could be zero.</p>
<p>Lets remove this feature and fit the model again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>correlated = correlated.tolist()
correlated.remove(&#39;horsepower&#39;)
num_formula = &#39; + &#39;.join(correlated)

formula = f&#39;price ~ {cat_formula} + {num_formula}&#39;

start = time.time()
model = smf.ols(formula=formula, data=X_train)
stop = time.time()

elapsed = stop - start
res = model.fit()
print(res.summary())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                            OLS Regression Results
==============================================================================
Dep. Variable:                  price   R-squared:                       0.969
Model:                            OLS   Adj. R-squared:                  0.969
Method:                 Least Squares   F-statistic:                     4050.
Date:                Mon, 06 Jul 2020   Prob (F-statistic):               0.00
Time:                        08:48:39   Log-Likelihood:                 7095.8
No. Observations:                7000   AIC:                        -1.408e+04
Df Residuals:                    6945   BIC:                        -1.370e+04
Df Model:                          54
Covariance Type:            nonrobust
=================================================================================================
                                    coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
Intercept                         4.7214      0.071     66.632      0.000       4.583       4.860
C(make)[T.audi]                   0.3190      0.019     16.970      0.000       0.282       0.356
C(make)[T.bmw]                    0.3628      0.017     20.991      0.000       0.329       0.397
C(make)[T.chevrolet]             -0.0893      0.018     -5.095      0.000      -0.124      -0.055
C(make)[T.dodge]                 -0.1344      0.014     -9.895      0.000      -0.161      -0.108
C(make)[T.honda]                  0.1620      0.016      9.903      0.000       0.130       0.194
C(make)[T.isuzu]                 -0.4441      0.020    -22.269      0.000      -0.483      -0.405
C(make)[T.jaguar]                -0.1556      0.021     -7.591      0.000      -0.196      -0.115
C(make)[T.mazda]                 -0.0030      0.013     -0.227      0.821      -0.029       0.023
C(make)[T.mercedes-benz]         -0.0196      0.020     -0.980      0.327      -0.059       0.020
C(make)[T.mercury]               -0.0852      0.022     -3.889      0.000      -0.128      -0.042
C(make)[T.mitsubishi]            -0.1401      0.014    -10.097      0.000      -0.167      -0.113
C(make)[T.nissan]                 0.0110      0.013      0.869      0.385      -0.014       0.036
C(make)[T.peugot]                -0.2786      0.015    -18.557      0.000      -0.308      -0.249
C(make)[T.plymouth]              -0.1678      0.014    -12.348      0.000      -0.194      -0.141
C(make)[T.porsche]                0.3321      0.022     15.155      0.000       0.289       0.375
C(make)[T.saab]                   0.1705      0.016     10.833      0.000       0.140       0.201
C(make)[T.subaru]                -0.1956      0.013    -14.798      0.000      -0.222      -0.170
C(make)[T.toyota]                -0.1422      0.012    -11.502      0.000      -0.166      -0.118
C(make)[T.volkswagen]            -0.0176      0.014     -1.236      0.217      -0.046       0.010
C(make)[T.volvo]                 -0.0372      0.016     -2.277      0.023      -0.069      -0.005
C(fuel_type)[T.gas]               2.2405      0.035     63.507      0.000       2.171       2.310
C(aspiration)[T.turbo]            0.1312      0.005     26.932      0.000       0.122       0.141
C(num_of_doors)[T.two]           -0.0475      0.004    -10.755      0.000      -0.056      -0.039
C(body_style)[T.hardtop]         -0.1471      0.010    -14.469      0.000      -0.167      -0.127
C(body_style)[T.hatchback]       -0.1869      0.009    -20.948      0.000      -0.204      -0.169
C(body_style)[T.sedan]           -0.1883      0.010    -19.255      0.000      -0.207      -0.169
C(body_style)[T.wagon]           -0.2639      0.010    -25.553      0.000      -0.284      -0.244
C(drive_wheels)[T.rwd]            0.1912      0.006     29.961      0.000       0.179       0.204
C(engine_location)[T.rear]        0.2957      0.016     18.758      0.000       0.265       0.327
C(engine_type)[T.l]              -0.1142      0.014     -8.387      0.000      -0.141      -0.088
C(engine_type)[T.ohc]            -0.0610      0.008     -7.567      0.000      -0.077      -0.045
C(engine_type)[T.ohcf]            0.1001      0.008     12.235      0.000       0.084       0.116
C(engine_type)[T.ohcv]           -0.1038      0.010    -10.035      0.000      -0.124      -0.084
C(num_of_cylinders)[T.five]      -0.1495      0.023     -6.460      0.000      -0.195      -0.104
C(num_of_cylinders)[T.four]      -0.0816      0.028     -2.880      0.004      -0.137      -0.026
C(num_of_cylinders)[T.six]       -0.1940      0.021     -9.207      0.000      -0.235      -0.153
C(num_of_cylinders)[T.three]      0.1644      0.024      6.919      0.000       0.118       0.211
C(num_of_cylinders)[T.twelve]    -0.0667      0.027     -2.471      0.013      -0.120      -0.014
C(fuel_system)[T.2bbl]            0.2077      0.012     17.438      0.000       0.184       0.231
C(fuel_system)[T.idi]             2.4809      0.037     67.489      0.000       2.409       2.553
C(fuel_system)[T.mfi]             0.2865      0.022     13.199      0.000       0.244       0.329
C(fuel_system)[T.mpfi]            0.2854      0.012     23.486      0.000       0.262       0.309
C(fuel_system)[T.spdi]            0.2449      0.015     16.551      0.000       0.216       0.274
C(fuel_system)[T.spfi]            0.5884      0.025     23.320      0.000       0.539       0.638
C(symboling)[T.-1]                0.1024      0.011      9.598      0.000       0.081       0.123
C(symboling)[T.0]                 0.1131      0.012      9.544      0.000       0.090       0.136
C(symboling)[T.1]                 0.0352      0.012      2.839      0.005       0.011       0.059
C(symboling)[T.2]                 0.0023      0.013      0.179      0.858      -0.023       0.028
C(symboling)[T.3]                 0.0857      0.014      6.180      0.000       0.058       0.113
bore                             -0.1812      0.014    -12.565      0.000      -0.210      -0.153
wheel_base                        0.0085      0.001     11.698      0.000       0.007       0.010
length                           -0.0045      0.000    -10.611      0.000      -0.005      -0.004
city_mpg                         -0.0176      0.001    -16.130      0.000      -0.020      -0.015
highway_mpg                       0.0130      0.001     13.570      0.000       0.011       0.015
width                             0.0228      0.002     11.846      0.000       0.019       0.027
engine_size                       0.0021      0.000     11.974      0.000       0.002       0.002
curb_weight                       0.0005   1.25e-05     37.323      0.000       0.000       0.000
==============================================================================
Omnibus:                        4.426   Durbin-Watson:                   1.999
Prob(Omnibus):                  0.109   Jarque-Bera (JB):                4.512
Skew:                          -0.040   Prob(JB):                        0.105
Kurtosis:                       3.095   Cond. No.                     1.02e+16
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 4.64e-22. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>res.pvalues[res.pvalues &gt; .05]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C(make)[T.mazda]            0.820602
C(make)[T.mercedes-benz]    0.327119
C(make)[T.nissan]           0.385010
C(make)[T.volkswagen]       0.216545
C(symboling)[T.2]           0.857865
dtype: float64
</pre></div></div>
</div>
<p>Now we are done with feature selection.</p>
</div>
<div class="section" id="Model-Scoring-&amp;-Evaluation">
<h2>Model Scoring &amp; Evaluation<a class="headerlink" href="#Model-Scoring-&-Evaluation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>r2 = res.rsquared_adj

predictions = np.exp(res.predict(X_test)) # back transformation
mse = np.mean(
    (predictions - np.exp(y_test))**2
)

print(f&#39;R^2: {r2:.4}&#39;)
print(f&#39;MSE: {mse:.4}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
R^2: 0.969
MSE: 2.175e+06
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>data = {
    &#39;model name&#39;: [&#39;ols&#39;],
    &#39;r2&#39;: [r2],
    &#39;MSE&#39;: [mse],
    &#39;time&#39;: elapsed
       }

score_df = pd.DataFrame(data)
score_df.to_csv(&#39;data/scores.csv&#39;, index=False)
score_df
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model name</th>
      <th>r2</th>
      <th>MSE</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ols</td>
      <td>0.968982</td>
      <td>2.175057e+06</td>
      <td>0.791958</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Residual-analysis">
<h2>Residual analysis<a class="headerlink" href="#Residual-analysis" title="Permalink to this headline">¶</a></h2>
<p>In a good model, we should expect that the residuals:</p>
<ul class="simple">
<li><p>have mean zero</p></li>
<li><p>to be homoscedastic</p></li>
<li><p>to be normal</p></li>
<li><p>to have no correlation with the fitted values</p></li>
<li><p>to have no correlation with any of the features</p></li>
</ul>
<div class="section" id="Residual-mean">
<h3>Residual mean<a class="headerlink" href="#Residual-mean" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>res.resid.mean() # good!
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-2.431832513138943e-15
</pre></div></div>
</div>
</div>
<div class="section" id="Residuals-vs-fitted-values">
<h3>Residuals vs fitted values<a class="headerlink" href="#Residuals-vs-fitted-values" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from numpy.polynomial.polynomial import polyfit
import matplotlib.pyplot as plt

%matplotlib inline

plt.figure(figsize=(12, 5))
plt.title(&#39;fitted price vs resids&#39;)
plt.scatter(res.fittedvalues, res.resid, c=&quot;g&quot;, alpha=0.5, label=&quot;OLS model&quot;)
b, m = polyfit(res.fittedvalues, res.resid, 1)
plt.plot(res.fittedvalues, b + m * res.fittedvalues, &#39;-&#39;)
plt.xlabel(&quot;&quot;)
plt.ylabel(&quot;&quot;)
plt.legend(loc=2)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x188e7925fc8&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03-ols_26_1.png" src="_images/03-ols_26_1.png" />
</div>
</div>
</div>
<div class="section" id="Correlation-between-residuals-and-\hat-y">
<h3>Correlation between residuals and <span class="math notranslate nohighlight">\(\hat y\)</span><a class="headerlink" href="#Correlation-between-residuals-and-\hat-y" title="Permalink to this headline">¶</a></h3>
<p>In a good model, residuals cannot be correlated to the fitted values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from scipy.stats.stats import pearsonr
pearsonr(res.predict(X_train), res.resid)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(8.134968393358477e-13, 0.9999999999497379)
</pre></div></div>
</div>
</div>
<div class="section" id="Test-for-normality">
<h3>Test for normality<a class="headerlink" href="#Test-for-normality" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import scipy.stats as st
st.shapiro(res.resid)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\BJ571WQ\Anaconda3\lib\site-packages\scipy\stats\morestats.py:1676: UserWarning: p-value may not be accurate for N &gt; 5000.
  warnings.warn(&#34;p-value may not be accurate for N &gt; 5000.&#34;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.9971299767494202, 2.398374832068839e-10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from statsmodels.graphics.gofplots import qqplot

qqplot(res.resid, line=&#39;s&#39;);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03-ols_31_0.png" src="_images/03-ols_31_0.png" />
</div>
</div>
</div>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="02-analysis-price.html"
       title="previous chapter">← Exploratory data analysis - price</a>
  </li>
  <li class="next">
    <a href="04-sklearn-linear.html"
       title="next chapter">Linear regression - sklearn →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2020, Erick Medeiros Anastácio.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
    </div>
    
    
  </body>
</html>